<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://kit.fontawesome.com/7b050bb505.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="styles.css">
    <style>
        body {
            padding-top: 60px;
            background-color: #fcf0a9;
            margin-bottom: 20px;
        }
        
        header {
            background-color: #fcf0a9;
        }

        nav a:hover, nav i:hover {
          font-weight: bold;
          color: red;
          cursor: pointer;
        }
        
        .grid-item {
            min-height: 45px;
            min-width: 45px;
            border: 1px solid black;
            border-radius: 10px;
            background-color: white;
        }
        
        .main {
            display: flex;
            width: 100%;
            height: 100%;
            align-items: center;
            justify-content: center;
        }
        
        .text {
            text-align: center;
        }
        
        .photo {
            display: flex;
            height: 100%;
            width: 20%;
            justify-content: center;
            align-items: center;
            text-align: center;
            margin-right: 20px;
        }
        
        .info {
            display: flex;
            flex-direction: column;
            height: 100%;
            width: 55%;
            justify-content: center;
            align-items: center;
            margin-left: 20px;
        }
        
        #personal {
            display: grid;
            width: 100%;
            grid-template-columns: repeat(3, 1fr);
            align-items: center;
        }
        
        #schedule {
            display: grid;
            width: 100%;
            grid-template-columns: repeat(7, 1fr);
            text-align: center;
            color: #243b04;
        }
        
        #scheduleTable {
            margin-top: 10px;
            display: none;
            flex-direction: column;
            max-width: 100%;
        }
        
        #myTable {
            max-width: 100%;
        }
        
        .edit-input {
            display: none;
            width: 80%;
        }
        
        .ok {
            display: none
        }
        
        button {
            border: none;
        }
        
        button:hover {
            background-color: #c7fa7f;
        }
        
        table {
            border-collapse: collapse;
            width: 100%;
            border: 2px solid black;
        }
        
        th, td {
            padding: 10px;
            text-align: center;
            border: 1px solid black;
        }
        
        th.column-header {
            background-color: #f2f2f2;
        }

        th.row-header {
            background-color: #e6e6e6;
        }
        
        td.selected {
            background-color: #ccc;

        }
        
        #connect-small, #hw-small {
            display: none;
        }
        
        @media screen and (max-width: 650px) {
            
            .photo {
                height: auto;
                margin-left: 20px;
                width: 90%;
            }
            
            .info {
                margin-right: 20px;
                width: 90%;
                justify-content: flex-start;
            }
            
            body {
                display: block;
                padding-top: 100px;
                width: 100vw;
                height: 100%;
            }
            
            #connect-full, #hw-full {
                display: none;
            }
            
            #connect-small, #hw-small {
                display: block;
            }
            .main {
                flex-direction: column;
                width: 100%;
            }
            
            #photo {
                max-width: 100%;
            }
            
            #myTable {
                font-size: 15px;
            }
        }
        
    </style>
    
    <title>Личный кабинет</title>
</head>
<body>
    <header>
      <nav>
        <ul>
            <li><a href="index.html" style="font-size:25px"><i class="fa-solid fa-house"></i></a></li>
            <li><a id="hw-full" href="#">Домашние задания</a></li>
            <li><i id="hw-small" class="fa-solid fa-book"></i></li>
            <li><a id="connect-full" href="#">Связаться с преподавателем</a></li>
            <li><i id="connect-small"class="fa-solid fa-comments"></i></li>
            <li><a href="#" style="font-size:25px"><i class="fa-solid fa-user"></i></a></li>
        </ul>
      </nav>
    </header>
    <div class="main">
        <div class="photo"><img id="photo" src="assets/18601.png" width="200px"></img></div>
        <div class="info">
            <div id="personal"></div>
            <div id="schedule">
                <p>Пн</p>
                <p>Вт</p>
                <p>Ср</p>
                <p>Чт</p>
                <p>Пт</p>
                <p>Сб</p>
                <p>Вс</p>
                
                <div id="monday" class="grid-item" style="background-color: #c7fa7f"></div>
                <div id="tuesday" class="grid-item"></div>
                <div id="wednesday" class="grid-item"></div>
                <div id="thursday" class="grid-item" style="background-color: #c7fa7f"></div>
                <div id="friday" class="grid-item"></div>
                <div id="saturday" class="grid-item"></div>
                <div id="sunday" class="grid-item"></div>
                
                <p id="monday1" class="time">16:00</p>
                <p id="tuesday1" class="time"></p>
                <p id="wednesday1" class="time"></p>
                <p id="thursday1" class="time">16:00</p>
                <p id="friday1" class="time"></p>
                <p id="saturday1" class="time"></p>
                <p id="sunday1" class="time"></p>
            </div>
            <div id="scheduleTable">
                <table id="myTable">
                    <tr>
                        <th class="row-header"></th>
                        <th class="column-header">Пн</th>
                        <th class="column-header" onclick="toggleColumn(this)">Вт</th>
                        <th class="column-header" onclick="toggleColumn(this)">Ср</th>
                        <th class="column-header" onclick="toggleColumn(this)">Чт</th>
                        <th class="column-header" onclick="toggleColumn(this)">Пт</th>
                        <th class="column-header" onclick="toggleColumn(this)">Сб</th>
                        <th class="column-header" onclick="toggleColumn(this)">Вс</th>
                    </tr>
                    <tr>
                        <th class="row-header">15:00</th>
                        <td onclick="toggleCell(this)"> </td>
                        <td onclick="toggleCell(this)"> </td>
                        <td onclick="toggleCell(this)"> </td>
                        <td onclick="toggleCell(this)"> </td>
                        <td onclick="toggleCell(this)"> </td>
                        <td onclick="toggleCell(this)"> </td>
                        <td onclick="toggleCell(this)"> </td>
                    </tr>
                    <tr>
                        <th class="row-header">16:00</th>
                        <td onclick="toggleCell(this)"> </td>
                        <td onclick="toggleCell(this)"> </td>
                        <td onclick="toggleCell(this)"> </td>
                        <td onclick="toggleCell(this)"> </td>
                        <td onclick="toggleCell(this)"> </td>
                        <td onclick="toggleCell(this)"> </td>
                        <td onclick="toggleCell(this)"> </td>
                    </tr>
                    <tr>
                        <th class="row-header">17:00</th>
                        <td onclick="toggleCell(this)"> </td>
                        <td onclick="toggleCell(this)"> </td>
                        <td onclick="toggleCell(this)"> </td>
                        <td onclick="toggleCell(this)"> </td>
                        <td onclick="toggleCell(this)"> </td>
                        <td onclick="toggleCell(this)"> </td>
                        <td onclick="toggleCell(this)"> </td>
                    </tr>
                    <tr>
                        <th class="row-header">18:00</th>
                        <td onclick="toggleCell(this)"> </td>
                        <td onclick="toggleCell(this)"> </td>
                        <td onclick="toggleCell(this)"> </td>
                        <td onclick="toggleCell(this)"> </td>
                        <td onclick="toggleCell(this)"> </td>
                        <td onclick="toggleCell(this)"> </td>
                        <td onclick="toggleCell(this)"> </td>
                    </tr>
                    <tr>
                        <th class="row-header">19:00</th>
                        <td onclick="toggleCell(this)"> </td>
                        <td onclick="toggleCell(this)"> </td>
                        <td onclick="toggleCell(this)"> </td>
                        <td onclick="toggleCell(this)"> </td>
                        <td onclick="toggleCell(this)"> </td>
                        <td onclick="toggleCell(this)"> </td>
                        <td onclick="toggleCell(this)"> </td>
                    </tr>
                    <tr>
                        <th class="row-header">20:00</th>
                        <td onclick="toggleCell(this)"> </td>
                        <td onclick="toggleCell(this)"> </td>
                        <td onclick="toggleCell(this)"> </td>
                        <td onclick="toggleCell(this)"> </td>
                        <td onclick="toggleCell(this)"> </td>
                        <td onclick="toggleCell(this)"> </td>
                        <td onclick="toggleCell(this)"> </td>
                    </tr>
                </table>
                <button id="scheduleOkButton" onclick="acceptSchedule()">OK</button>
            </div>
        </div>
    </div>

<script>
    var toggledCells = [];
    
    var urlParams = new URLSearchParams(window.location.search);
    var inputName = urlParams.get('name');
    var inputSurname = urlParams.get('surname');
    var inputGrade = urlParams.get('grade');
    
    personalInfoDiv = document.getElementById('personal');
    personalInfoDiv.innerHTML = `
            <p>Имя: </p>
            <p id="name" class="text">
                <input type="text" class="edit-input" id="nameEdit">
                <span id="nameText">${inputName}</span>
            </p>
            <button id="nameEditButton" class="edit" onclick="edit('name')">ред.</button>
            <button id="nameOkButton" class="ok" onclick="accept('name')">OK</button>
    
            <p>Фамилия: </p>
            <p id="surname" class="text">
                <input type="text" class="edit-input" id="surnameEdit">
                <span id="surnameText">${inputSurname}</span>
            </p>
            <button id="surnameEditButton" class="edit" onclick="edit('surname')">ред.</button>
            <button id="surnameOkButton" class="ok" onclick="accept('surname')">OK</button>
        
            <p>Статистика выполненных работ: </p>
            <p id="statistics" class="text">${inputGrade}</p>
            <p></p>
        
            <p>Расписание: </p>
            <p></p>
            <button class="edit" onclick="editSchedule()">ред.</button>
    
    
        `

    function edit(id) {
        var editInput = document.getElementById(`${id}Edit`);
        var editText = document.getElementById(`${id}Text`);
        var editButton = document.getElementById(`${id}EditButton`);
        var okButton = document.getElementById(`${id}OkButton`);
        
        
        editInput.style.display = 'inline-block';
        editText.style.display = 'none';
        editButton.style.display = 'none';
        okButton.style.display = 'inline-block';
    }
    
    function accept(id) {
        var editInput = document.getElementById(`${id}Edit`);
        var editText = document.getElementById(`${id}Text`);
        var editButton = document.getElementById(`${id}EditButton`);
        var okButton = document.getElementById(`${id}OkButton`);
        
        
        editInput.style.display = 'none';
        editText.style.display = 'inline-block';
        editButton.style.display = 'inline-block';
        okButton.style.display = 'none';
        
        editText.innerHTML = `${editInput.value}`;
    }
    
    function editSchedule() {
        var schedule = document.getElementById("scheduleTable");
        schedule.style.display = 'flex';
    }
    
    function acceptSchedule() {
        var days = ["monday", "tuesday", "wednesday", "thursday", "friday", "saturday", "sunday"];
        
        var schedule = document.getElementById("scheduleTable");
        schedule.style.display = 'none';
        
        var timeP = document.querySelectorAll(".time");
        timeP.forEach(function(element) {
          element.remove();
        });
        
        toggledCells = document.querySelectorAll(".selected");
        times = {};
        days.forEach(day => {
            times[day] = [];
        });
        timesCnt = 1;
        
        daysItems = document.querySelectorAll(".grid-item");
        daysItems.forEach(function(dayItem) {
            dayItem.style.backgroundColor = 'white';
        });
        
        var table = document.getElementById("myTable");
        
        for (var i = 0; i < table.rows.length; i++) {
            var row = table.rows[i];
            for (var j = 0; j < row.cells.length; j++) {
                var cell = row.cells[j];
                if (Array.from(toggledCells).includes(cell)) {
                    dayIndex = (j - 1) % 7;
                    day = days[dayIndex];
                    
                    document.getElementById(day).style.backgroundColor = '#c7fa7f';
                    times[day].push(row.cells[0].textContent);
                    if (times[day].length > 1)
                        timesCnt++;
                }
            }
       }
        console.log(times);
        for (var i = 1; i <= timesCnt; i++) {
            for (var j = 0; j < 7; j++) {
                var timeIndex = days[j];
                var time = times[timeIndex][i - 1];
                console.log(timeIndex, i, time);
                if (time) {
                    document.getElementById("schedule").innerHTML += `<p id=${days[j]}${i} class="time">${times[timeIndex][i - 1]}</p>`;
                } else {
                    document.getElementById("schedule").innerHTML += `<p id=${days[j]}${i} class="time"> </p>`;
                }
            }
        }
    }
    
    function toggleCell(cell) {
        cell.classList.toggle("selected");
    }

</script>

</body>
</html>
